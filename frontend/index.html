<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TourSync - Your Band's Travel Command Center</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/logo-flow.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/services-offerings.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <link rel="stylesheet" href="css/email-popup.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Force square corners on all gallery images -->
    <style>
        .gallery-image, .gallery-image:before, .gallery-image:after {
            border-radius: 0 !important;
            -webkit-border-radius: 0 !important;
            -moz-border-radius: 0 !important;
            overflow: hidden !important;
        }
        div[class*="gallery"] img, div[class*="gallery"] div {
            border-radius: 0 !important;
            -webkit-border-radius: 0 !important;
            -moz-border-radius: 0 !important;
        }
    </style>
</head>
<!-- Add this RIGHT AFTER the opening <body> tag in index.html -->
<script>
  window.SUPABASE_CONFIG = {
    url: 'https://gdmdurzaeezcrgrmtabx.supabase.co',
    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdkbWR1cnphZWV6Y3Jncm10YWJ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1OTk7MDUsImV4cCI6MjA2MzE3NTcwNX0.xbuXRr2jDAAG021blK5zeuqwO-5zMNq7_tEfW_oW7cQ'
  };
  console.log('ðŸ”‘ Supabase config loaded for TourSync');
</script>
<body>
    
    <header class="hero" style="background-image: linear-gradient(rgba(30, 27, 75, 0.85), rgba(49, 46, 129, 0.85)), url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=1350&q=80'); background-size: cover; background-position: center;">
        <nav class="navbar">
            <div class="logo">
              <a href="index.html">
                <span class="logo-text">TourSync</span>
              </a>
            </div>
            <div class="nav-links">
              <a href="#how-selfnvest-works">About</a>
              <a href="#services">Services</a>
              <a href="#pricing">Pricing</a>
              <a href="#footer">Contact Us</a>
              <a href="pages/listings.html">Listings</a>
              <a href="pages/assistant.html">Dashboard</a>
              <a href="pages/login.html" id="auth-link">
                <i class="fas fa-user"></i> Login
              </a>
            </div>
            <button class="mobile-menu-toggle" onclick="toggleMobileNav()">
              <i class="fas fa-bars"></i>
            </button>
          </nav>
          
          <!-- Mobile Navigation Menu -->
          <div class="mobile-nav-overlay" onclick="closeMobileNav()"></div>
          <div class="mobile-nav">
            <div class="mobile-nav-header">
              <span class="logo-text">TourSync</span>
              <button class="mobile-nav-close" onclick="closeMobileNav()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="mobile-nav-links">
              <a href="#how-selfnvest-works"><i class="fas fa-info-circle"></i> About</a>
              <a href="#services"><i class="fas fa-concierge-bell"></i> Services</a>
              <a href="#pricing"><i class="fas fa-dollar-sign"></i> Pricing</a>
              <a href="#footer"><i class="fas fa-envelope"></i> Contact Us</a>
              <a href="pages/listings.html"><i class="fas fa-home"></i> Listings</a>
              <a href="pages/assistant.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            </div>
            <div class="mobile-auth-section">
              <a href="pages/login.html"><i class="fas fa-user"></i> Login</a>
            </div>
          </div>
        <div class="hero-content">
            <h1>Your Band's Travel Command Center</h1>
            <p>Coordinate tours, manage logistics, and keep your band in sync on the road with Roadie AI</p>
            <button class="cta-button" onclick="handleGetStarted()">Get Started</button>
        </div>
    </header>

    <section id="how-selfnvest-works" class="how-selfnvest-works">
        <div class="section-header text-center">
            <button class="cta-button">About Us</button>
            <h2>How TourSync Works</h2>
        </div>
        <div class="section-text">
            <p>TourSync empowers touring bands to navigate the road independently, cutting out expensive tour managers and saving thousands in management fees.</p>
            <p>Our platform provides all the tools, resources, and support you need to manage your tours on your own terms.</p>
        </div>
        <div class="content-wrapper">
            <div class="gallery-wrapper">
                <div class="scrolling-image-gallery">
                    <!-- Tour/band related images -->
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1506157786151-b8491531f063?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1540039155733-5bb30b53aa14?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1514533450685-4493e01d1624?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1501386761578-eac5c94b800a?auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="gallery-image" style="background-image: url('https://images.unsplash.com/photo-1493676304819-0d7a8d026dcf?auto=format&fit=crop&w=800&q=80');"></div>
                    
                    <!-- Image upload containers -->
                    <div class="gallery-image upload-container">
                        <input type="file" id="image-upload-1" class="image-upload" accept="image/*">
                        <label for="image-upload-1" class="upload-label">
                            <i class="fas fa-plus"></i>
                            <span>Add Image</span>
                        </label>
                    </div>
                    
                    <div class="gallery-image upload-container">
                        <input type="file" id="image-upload-2" class="image-upload" accept="image/*">
                        <label for="image-upload-2" class="upload-label">
                            <i class="fas fa-plus"></i>
                            <span>Add Image</span>
                        </label>
                    </div>
                    
                    <div class="gallery-image upload-container">
                        <input type="file" id="image-upload-3" class="image-upload" accept="image/*">
                        <label for="image-upload-3" class="upload-label">
                            <i class="fas fa-plus"></i>
                            <span>Add Image</span>
                        </label>
                    </div>
                    
                    <div class="gallery-image upload-container">
                        <input type="file" id="image-upload-4" class="image-upload" accept="image/*">
                        <label for="image-upload-4" class="upload-label">
                            <i class="fas fa-plus"></i>
                            <span>Add Image</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="services" class="services-section">
        <div class="section-header text-center">
            <a href="#services"><button class="cta-button">Selling</button></a>
            <h2>What we offer</h2>
            <p class="subheader">Let's find the right path for you</p>
        </div>
        <div class="services">
            <div class="service-offerings">
                <div class="service-offering-item">
                    <div class="offering-number"><i class="fas fa-route"></i></div>
                    <div class="offering-content">
                        <h3>Smart Route Planning</h3>
                        <ul>
                            <li>Optimized travel routes between venues</li>
                            <li>Real-time traffic and weather updates</li>
                            <li>Fuel cost calculations and stop suggestions</li>
                        </ul>
                    </div>
                </div>
                
                <div class="service-offering-item">
                    <div class="offering-number"><i class="fas fa-bed"></i></div>
                    <div class="offering-content">
                        <h3>Accommodation Booking</h3>
                        <ul>
                            <li>Band-friendly hotels and motels</li>
                            <li>Group booking discounts</li>
                            <li>Equipment storage considerations</li>
                        </ul>
                    </div>
                </div>
                
                <div class="service-offering-item">
                    <div class="offering-number"><i class="fas fa-calendar-alt"></i></div>
                    <div class="offering-content">
                        <h3>Schedule Coordination</h3>
                        <ul>
                            <li>Master tour calendar for all band members</li>
                            <li>Automatic timezone adjustments</li>
                            <li>Venue and soundcheck time management</li>
                        </ul>
                    </div>
                </div>
                
                <div class="service-offering-item">
                    <div class="offering-number"><i class="fas fa-robot"></i></div>
                    <div class="offering-content">
                        <h3>AI Assistant â€“ "Roadie"</h3>
                        <ul>
                            <li>24/7 tour support and travel advice</li>
                            <li>Emergency contact and backup planning</li>
                            <li>Local venue and city recommendations</li>
                        </ul>
                    </div>
                </div>
                
                <div class="service-offering-item">
                    <div class="offering-number"><i class="fas fa-dollar-sign"></i></div>
                    <div class="offering-content">
                        <h3>Budget Management</h3>
                        <ul>
                            <li>Tour expense tracking and reporting</li>
                            <li>Per diem calculations for band members</li>
                            <li>Revenue and profit tracking by show</li>
                        </ul>
                    </div>
                </div>
                
                <div class="service-offering-item">
                    <div class="offering-number"><i class="fas fa-truck"></i></div>
                    <div class="offering-content">
                        <h3>Equipment & Logistics</h3>
                        <ul>
                            <li>Gear transportation planning</li>
                            <li>Load-in/load-out time coordination</li>
                            <li>Local crew and equipment rental contacts</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="pricing" class="pricing">
        <div class="section-header text-center">
            <button class="cta-button">Our Prices</button>
            <h2 style="font-size: 36px;">Keep Your Touring Profits. Invest In Your Band</h2>
        </div>
        <div class="pricing-grid">
            <div class="price-card">
                <div class="price-card-content">
                    <p style="text-align: center; font-weight: 600; margin-bottom: 15px; text-transform: uppercase; font-size: 16px;">Basic Tour Support</p>
                    <h3>$9.99<span style="font-size: 16px; color: #666;">/month</span></h3>
                    <div class="line"></div>
                    <h4>Essential Package</h4>
                    <ul>
                        <li>Roadie AI Assistant</li>
                        <li>Basic Route Planning</li>
                        <li>Shared Tour Calendar</li>
                        <li>Expense Tracking</li>
                        <li>Mobile App Access</li>
                        <li>Email Support</li>
                    </ul>
                    <div class="button-container">
                        <button class="cta-button dark" id="premium-button">
                            Get Started
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="price-card featured">
                <div class="price-card-content">
                    <p style="text-align: center; font-weight: 600; margin-bottom: 15px; text-transform: uppercase; font-size: 16px;">Professional Tour Management</p>
                    <h3>$19.99<span style="font-size: 16px; color: #666;">/month</span></h3>
                    <div class="line"></div>
                    <h4>Premium Package</h4>
                    <ul>
                        <li>Advanced Roadie AI with Tour Analytics</li>
                        <li>Smart Route Optimization</li>
                        <li>Automated Booking Assistance</li>
                        <li>Advanced Budget & Revenue Tracking</li>
                        <li>Equipment & Crew Management</li>
                        <li>Priority Support & Phone Access</li>
                        <li>Custom Tour Reports</li>
                    </ul>
                    <div class="button-container">
                        <button class="cta-button dark" id="standard-button">
                            Get Started
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="showcase" class="mission-statement">
        <div class="section-header text-center">
            <button class="cta-button">Our Mission</button>
            <h2 style="font-size: 36px;">Keep Your Band in Sync</h2>
        </div>
        <div class="mission-content-wrapper">
            <div class="mission-text">
                <p>We started TourSync because we know how chaotic touring can be. Between managing logistics, coordinating schedules, and keeping everyone on the same page, the music can get lost in the madness.</p>
                <p>Our platform was built by musicians, for musicians. We understand the unique challenges of life on the road and created tools that actually work for touring bands.</p>
                <p>From local gigs to cross-country tours, TourSync keeps your band organized, your budget on track, and your focus on what matters most â€“ the music.</p>
            </div>
            <div class="mission-quote">
                <div class="quote-image">
                    <img src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=800&q=80" alt="Band on Tour" style="width: 100%; height: auto; object-fit: cover;">
                </div>
            </div>
        </div>
        <div class="mission-footer-quote">
            <span class="quote-mark">"</span>
            <p>"Focus on your music. We'll handle the rest."</p>
        </div>
    </section>

    <section id="savings-calculator" class="savings-calculator">
        <div class="calculator-container">
            <div class="calculator-header">
                <button class="cta-button">Savings</button>
                <h2>See how much you can save</h2>
            </div>
            <div class="slider-container">
                <div class="slider-track">
                    <input type="range" min="0" max="1000000" value="500000" class="slider" id="savings-slider">
                    <div class="slider-thumb"></div>
                </div>
                <div class="slider-values">
                    <span class="min-value">$0</span>
                    <span class="current-value" id="current-savings">$500,000</span>
                    <span class="max-value">$1,000,000</span>
                </div>
                <div class="savings-message">
                    <p>By using TourSync, you could save up to <span id="savings-percentage">3%</span> on your tour management costs.</p>
                    <p class="savings-total">Total savings: <span id="total-savings">$15,000</span></p>
                </div>
            </div>
        </div>
    </section>

    <section id="testimonials" class="testimonials">
        <div class="section-header">
            <div class="line"></div>
            <h2>Hear from our clients</h2>
        </div>
        <div class="testimonial-container">
            <!-- First row - moves left -->
            <div class="testimonial-row">
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"TourSync saved our band countless hours of planning. The route optimization alone paid for itself on our first tour."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">The Electric Collective</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"Roadie AI is like having a tour manager in your pocket. It knew venues we'd never heard of and saved us from booking disasters."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Midnight Frequencies</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"The budget tracking feature helped us turn our first profitable tour. We finally knew where our money was going."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Sonic Drift</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"As an indie band, we couldn't afford a real tour manager. TourSync gave us professional-level organization at a fraction of the cost."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Neon Wanderers</p>
                    </div>
                </div>
                <!-- Duplicate cards to ensure smooth infinite scrolling -->
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"TourSync saved our band countless hours of planning. The route optimization alone paid for itself on our first tour."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">The Electric Collective</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"Roadie AI is like having a tour manager in your pocket. It knew venues we'd never heard of and saved us from booking disasters."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Midnight Frequencies</p>
                    </div>
                </div>
            </div>
            
            <!-- Second row - moves right -->
            <div class="testimonial-row">
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"The accommodation booking feature found us places we never would have discovered. Plus the group discounts were amazing."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1506157786151-b8491531f063?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Storm Chasers</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"The shared calendar kept our whole band on the same page. No more missed soundchecks or confused arrival times."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1540039155733-5bb30b53aa14?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Velvet Thunder</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"Equipment logistics used to be our biggest headache. TourSync's crew contacts and load-in planning changed everything."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1514533450685-4493e01d1624?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Amplified Chaos</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"TourSync transformed us from a chaotic mess into a professional touring act. Our fans noticed the difference immediately."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1501386761578-eac5c94b800a?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Reverb Nation</p>
                    </div>
                </div>
                <!-- Duplicate cards to ensure smooth infinite scrolling -->
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"The accommodation booking feature found us places we never would have discovered. Plus the group discounts were amazing."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1506157786151-b8491531f063?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Storm Chasers</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                    <p>"The shared calendar kept our whole band on the same page. No more missed soundchecks or confused arrival times."</p>
                    <div class="client-info">
                        <div class="client-img" style="background-image: url('https://images.unsplash.com/photo-1540039155733-5bb30b53aa14?auto=format&fit=crop&w=400&q=80');"></div>
                        <p class="client-name">Velvet Thunder</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="faq" class="faq">
        <div class="section-header">
            <div class="line"></div>
            <h2>Answering your questions</h2>
        </div>
        <div class="faq-grid">
            <div class="faq-item">
                <h3>How does buying without an agent work?</h3>
                <div class="faq-toggle">+</div>
            </div>
            <div class="faq-item">
                <h3>What support do you provide during the selling process?</h3>
                <div class="faq-toggle">+</div>
            </div>
            <div class="faq-item">
                <h3>How much can I really save by using SelfNVest?</h3>
                <div class="faq-toggle">+</div>
            </div>
            <div class="faq-item">
                <h3>Is it legal to buy or sell without a real estate agent?</h3>
                <div class="faq-toggle">+</div>
            </div>
        </div>
    </section>

  <!-- FOOTER -->
  <footer id="footer">
    <div class="footer-content">
      <div class="footer-logo">
        <a href="index.html"><span class="logo-text">TourSync</span></a>
      </div>
      <div class="footer-links">
        <div class="footer-column">
          <h4>Services</h4>
          <a href="#how-selfnvest-works">About</a>
          <a href="#services">Services</a>
          <a href="#pricing">Pricing</a>
          <a href="#testimonials">Testimonials</a>
        </div>
        <div class="footer-column">
          <h4>About</h4>
          <a href="#faq">FAQ</a>
          <a href="pages/login.html">Login</a>
          <a href="pages/listings.html">Listings</a>
          <a href="#footer" onclick="openEmailPopup(); return false;">Contact</a>
        </div>
        <div class="footer-column">
          <h4>Legal</h4>
          <a href="#terms">Terms</a>
          <a href="#privacy">Privacy</a>
          <a href="#cookies">Cookies</a>
          <a href="#licenses">Licenses</a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 TourSync. All rights reserved.</p>
      <div class="social-links">
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="https://www.instagram.com/toursync_app" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-linkedin"></i></a>
        <a href="#" id="email-contact-btn" title="Contact Us"><i class="fas fa-envelope"></i></a>
      </div>
    </div>
  </footer>

    <!-- === FIXED SCRIPT LOADING ORDER === -->
    
    <!-- 1. FIRST: Load Supabase library -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- 2. SECOND: Initialize Supabase client -->
    <script src="js/supabaseClient.js"></script>
    
    <!-- 3. THIRD: Load global auth (THIS WAS MISSING!) -->
    <script src="js/globalAuth.js"></script>
    
    <!-- 3.5. Load main auth functions -->
    <script src="js/auth.js"></script>
    
    <!-- 4. FOURTH: Load other functionality -->
    <script src="js/script.js"></script>
    <script src="js/scrolling-gallery.js"></script>
    <script src="js/testimonial-scroll.js"></script>
    
    <!-- 5. FIFTH: Load chatbot -->
    <script src="js/chatbot.js"></script>

    <!-- 6. AUTH DEBUG SCRIPT (temporary) -->
    <script>
    console.log('=== AUTH REDIRECT DEBUGGING ===');

    // Check if we just came from a login
    const referrer = document.referrer;
    const isFromLogin = referrer.includes('/login') || referrer.includes('pages/login');
    console.log('Page loaded from:', referrer);
    console.log('Came from login page:', isFromLogin);

    // Function to check auth state with detailed logging
    async function detailedAuthCheck(checkNumber) {
        console.log(`\n=== AUTH CHECK #${checkNumber} ===`);
        
        // 1. Check Supabase session
        if (typeof supabase !== 'undefined') {
            try {
                const { data, error } = await supabase.auth.getSession();
                console.log('1. Supabase Session Check:');
                console.log('   - Error:', error?.message || 'None');
                console.log('   - Has session:', !!data?.session);
                console.log('   - Access token:', data?.session?.access_token ? 'Present' : 'None');
                console.log('   - User email:', data?.session?.user?.email || 'None');
                
                // If we have a session but global auth doesn't know about it
                if (data?.session && (!window.authState || !window.authState.isLoggedIn)) {
                    console.log('MISMATCH: Supabase has session but authState is not logged in!');
                    
                    // Try to fix it manually
                    if (window.auth && window.auth.getCurrentUser) {
                        console.log('Attempting to fix auth state...');
                        const user = await window.auth.getCurrentUser();
                        if (user) {
                            console.log('Auth state fixed for:', user.email);
                            window.auth.updateGlobalUI();
                        }
                    }
                    
                    return { mismatch: true, session: data.session };
                }
                
                return { session: data?.session, error };
            } catch (err) {
                console.error('Supabase session check failed:', err);
                return { error: err };
            }
        } else {
            console.log('Supabase not available');
            return { error: 'Supabase not available' };
        }
    }

    // Check localStorage
    function checkLocalStorage() {
        console.log('2. LocalStorage Check:');
        const keys = ['supabase_token', 'user_email', 'user_id'];
        keys.forEach(key => {
            const value = localStorage.getItem(key);
            console.log(`   - ${key}:`, value ? (key.includes('token') ? value.substring(0, 20) + '...' : value) : 'null');
        });
    }

    // Check global auth state
    function checkGlobalAuthState() {
        console.log('3. Global Auth State Check:');
        console.log('   - window.authState exists:', typeof window.authState !== 'undefined');
        console.log('   - window.auth exists:', typeof window.auth !== 'undefined');
        
        if (window.authState) {
            console.log('   - authState.isLoggedIn:', window.authState.isLoggedIn);
            console.log('   - authState.user:', window.authState.user?.email || 'None');
            console.log('   - authState.isLoading:', window.authState.isLoading);
        }
    }

    // Run checks every 3 seconds for 5 times
    let checkCount = 0;
    const maxChecks = 5;

    async function runPeriodicCheck() {
        checkCount++;
        console.log(`Running auth check ${checkCount}/${maxChecks}`);
        
        await detailedAuthCheck(checkCount);
        checkLocalStorage();
        checkGlobalAuthState();
        
        if (checkCount < maxChecks) {
            setTimeout(runPeriodicCheck, 3000);
        } else {
            console.log('Auth monitoring complete');
        }
    }

    // Start monitoring after scripts load
    setTimeout(() => {
        console.log('Starting auth monitoring...');
        runPeriodicCheck();
    }, 2000);

    // Manual fix function
    window.forceAuthRefresh = async function() {
        console.log('Force auth refresh triggered...');
        
        if (window.auth && window.auth.init) {
            await window.auth.init();
            console.log('Auth re-initialized');
        }
        
        if (window.auth && window.auth.updateGlobalUI) {
            window.auth.updateGlobalUI();
            console.log('UI updated');
        }
    };
    </script>

    <!-- 7. MAIN FUNCTIONALITY SCRIPTS -->
    <script>
        // Simple Get Started function
        function handleGetStarted() {
            console.log('Get Started clicked - scrolling to pricing');
            const pricingSection = document.getElementById('pricing');
            if (pricingSection) {
                pricingSection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // UPDATED pricing button handlers to check auth state
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for auth to load, then setup buttons
            setTimeout(() => {
                const premiumBtn = document.getElementById('premium-button');
                const standardBtn = document.getElementById('standard-button');
                
                if (premiumBtn) {
                    premiumBtn.addEventListener('click', function() {
                        // Check if user is authenticated
                        if (window.auth && window.auth.isAuthenticated()) {
                            console.log('User authenticated, starting checkout for premium');
                            window.auth.createCheckoutSession('premium');
                        } else {
                            console.log('User not authenticated, redirecting to login');
                            localStorage.setItem('selected_plan', 'premium');
                            window.location.href = 'pages/login.html';
                        }
                    });
                }
                
                if (standardBtn) {
                    standardBtn.addEventListener('click', function() {
                        // Check if user is authenticated
                        if (window.auth && window.auth.isAuthenticated()) {
                            console.log('User authenticated, starting checkout for standard');
                            window.auth.createCheckoutSession('standard');
                        } else {
                            console.log('User not authenticated, redirecting to login');
                            localStorage.setItem('selected_plan', 'standard');
                            window.location.href = 'pages/login.html';
                        }
                    });
                }
            }, 2000); // Wait 2 seconds for auth scripts to load
            
            // Savings calculator functionality
            const slider = document.getElementById('savings-slider');
            const currentSavings = document.getElementById('current-savings');
            const totalSavings = document.getElementById('total-savings');
            const sliderThumb = document.querySelector('.slider-thumb');
            
            if (slider && currentSavings && totalSavings) {
                // Set initial position of the custom thumb
                updateThumbPosition();
                
                // Update values when slider moves
                slider.addEventListener('input', function() {
                    updateValues();
                    updateThumbPosition();
                });
                
                // Also handle mousedown, mousemove, and mouseup events for smoother experience
                slider.addEventListener('mousedown', function() {
                    document.addEventListener('mousemove', updateThumbPosition);
                    document.addEventListener('mouseup', function() {
                        document.removeEventListener('mousemove', updateThumbPosition);
                    }, { once: true });
                });
                
                // Handle touch events for mobile
                slider.addEventListener('touchstart', function() {
                    document.addEventListener('touchmove', updateThumbPosition);
                    document.addEventListener('touchend', function() {
                        document.removeEventListener('touchmove', updateThumbPosition);
                    }, { once: true });
                });
            }
            
            function updateValues() {
                // Format the property value with commas
                const propertyValue = parseInt(slider.value);
                const formattedValue = ' + propertyValue.toLocaleString();
                currentSavings.textContent = formattedValue;
                
                // Calculate savings (3% of property value)
                const savingsAmount = Math.round(propertyValue * 0.03);
                totalSavings.textContent = ' + savingsAmount.toLocaleString();
            }
            
            function updateThumbPosition() {
                // Calculate position percentage
                const percent = (slider.value - slider.min) / (slider.max - slider.min);
                const thumbPosition = percent * 100;
                
                // Update custom thumb position
                if (sliderThumb) {
                    sliderThumb.style.left = `${thumbPosition}%`;
                }
                
                // Update slider track color
                slider.style.background = `linear-gradient(to right, 
                    var(--primary-color) 0%, 
                    var(--primary-color) ${thumbPosition}%, 
                    #e0e0e0 ${thumbPosition}%, 
                    #e0e0e0 100%)`;
            }
            
            // Initialize values if slider exists
            if (slider) {
                updateValues();
            }
            
            // Image upload functionality
            const imageUploads = document.querySelectorAll('.image-upload');
            
            imageUploads.forEach(upload => {
                upload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            // Get the parent container
                            const container = e.target.closest('.upload-container');
                            
                            // Set the background image
                            container.style.backgroundImage = `url(${event.target.result})`;
                            container.style.backgroundSize = 'cover';
                            container.style.backgroundPosition = 'center';
                            
                            // Hide the upload label
                            const label = container.querySelector('.upload-label');
                            if (label) {
                                label.style.display = 'none';
                            }
                            
                            // Add a remove button
                            if (!container.querySelector('.remove-image')) {
                                const removeBtn = document.createElement('button');
                                removeBtn.className = 'remove-image';
                                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                                removeBtn.addEventListener('click', function(evt) {
                                    evt.stopPropagation();
                                    container.style.backgroundImage = 'none';
                                    e.target.value = '';
                                    if (label) {
                                        label.style.display = 'flex';
                                    }
                                    this.remove();
                                });
                                container.appendChild(removeBtn);
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        });

        // Mobile navigation functions
        function toggleMobileNav() {
          const mobileNav = document.querySelector('.mobile-nav');
          const overlay = document.querySelector('.mobile-nav-overlay');
          
          if (mobileNav && overlay) {
            mobileNav.classList.toggle('active');
            overlay.classList.toggle('active');
            document.body.classList.toggle('mobile-menu-open');
          }
        }

        function closeMobileNav() {
          const mobileNav = document.querySelector('.mobile-nav');
          const overlay = document.querySelector('.mobile-nav-overlay');
          
          if (mobileNav) mobileNav.classList.remove('active');
          if (overlay) overlay.classList.remove('active');
          document.body.classList.remove('mobile-menu-open');
        }

        // Expose mobile functions globally
        window.toggleMobileNav = toggleMobileNav;
        window.closeMobileNav = closeMobileNav;
    </script>

    <!-- Chat CSS and HTML -->
    <link rel="stylesheet" href="css/vesty-chat.css">
    
    <!-- Chat Toggle Button -->
    <button id="vesty-toggle-btn" onclick="toggleChat()" aria-label="Chat with Roadie AI Assistant"></button>

    <!-- Chat Container -->
    <div class="chat-container">
      <div class="chat-header">
        <h1>
          <div class="bot-avatar">
            <i class="fas fa-robot"></i>
          </div>
          Roadie AI Assistant
        </h1>
        <button class="chat-close-btn" onclick="toggleChat()" title="Hide chat">Ã—</button>
      </div>

      <div class="chat-messages" id="messages">
        <div class="welcome-message">
          <i class="fas fa-route"></i>
          <h2>Welcome to TourSync AI</h2>
          <p>I'm Roadie, your virtual tour assistant. Ask me about route planning, venue bookings, or any tour logistics!</p>
        </div>
      </div>

      <div class="chat-input">
        <div class="input-container">
          <textarea id="user-input" placeholder="Ask Roadie about your tour..." rows="1"></textarea>
        </div>
        <div class="input-actions">
          <button id="send-button" title="Send message">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Email Contact Popup -->
    <div id="email-popup" class="email-popup">
      <div class="email-popup-content">
        <div class="email-popup-header">
          <h3>Contact TourSync</h3>
          <button class="email-close-btn" onclick="closeEmailPopup()">&times;</button>
        </div>
        <div class="email-popup-body">
          <div id="success-message" class="success-message">
            <i class="fas fa-check-circle"></i> Your message has been sent successfully! We'll get back to you soon.
          </div>
          <div id="error-message" class="error-message">
            <i class="fas fa-exclamation-triangle"></i> <span id="error-text">Something went wrong. Please try again.</span>
          </div>
          <form id="contact-form" onsubmit="sendEmail(event)">
            <div class="form-group">
              <label for="sender-name">Your Name *</label>
              <input type="text" id="sender-name" name="senderName" required>
            </div>
            <div class="form-group">
              <label for="sender-email">Your Email *</label>
              <input type="email" id="sender-email" name="senderEmail" required>
            </div>
            <div class="form-group">
              <label for="email-subject">Subject *</label>
              <input type="text" id="email-subject" name="subject" required>
            </div>
            <div class="form-group">
              <label for="email-message">Message *</label>
              <textarea id="email-message" name="message" rows="5" required></textarea>
            </div>
            <div class="form-actions">
              <button type="button" onclick="closeEmailPopup()" class="btn-cancel">Cancel</button>
              <button type="submit" class="btn-send">Send Message</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Email Contact JavaScript -->
    <script>
        // Email popup functionality
        function openEmailPopup() {
            const popup = document.getElementById('email-popup');
            popup.classList.add('show');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
            
            // Reset form and messages
            document.getElementById('contact-form').reset();
            hideMessages();
        }

        function closeEmailPopup() {
            const popup = document.getElementById('email-popup');
            popup.classList.remove('show');
            document.body.style.overflow = 'auto'; // Restore scrolling
            
            // Reset form and messages
            document.getElementById('contact-form').reset();
            hideMessages();
        }

        function hideMessages() {
            document.getElementById('success-message').classList.remove('show');
            document.getElementById('error-message').classList.remove('show');
        }

        function showSuccessMessage() {
            hideMessages();
            document.getElementById('success-message').classList.add('show');
        }

        function showErrorMessage(message = 'Something went wrong. Please try again.') {
            hideMessages();
            document.getElementById('error-text').textContent = message;
            document.getElementById('error-message').classList.add('show');
        }

        // Send email function
        async function sendEmail(event) {
            event.preventDefault();
            
            const sendBtn = document.querySelector('.btn-send');
            const originalText = sendBtn.textContent;
            
            // Show loading state
            sendBtn.classList.add('loading');
            sendBtn.textContent = 'Sending...';
            sendBtn.disabled = true;
            
            // Get form data
            const formData = new FormData(event.target);
            const emailData = {
                to: 'support@toursync.app',
                from: formData.get('senderEmail'),
                senderName: formData.get('senderName'),
                subject: formData.get('subject'),
                message: formData.get('message')
            };

            try {
                // Create mailto link as fallback
                const mailtoLink = `mailto:support@toursync.app?subject=${encodeURIComponent(emailData.subject)}&body=${encodeURIComponent(
                    `From: ${emailData.senderName} (${emailData.from})\n\nMessage:\n${emailData.message}`
                )}`;
                
                // Try to open default email client
                window.location.href = mailtoLink;
                
                // Show success message
                showSuccessMessage();
                
                // Auto close after 3 seconds
                setTimeout(() => {
                    closeEmailPopup();
                }, 3000);
                
            } catch (error) {
                console.error('Email error:', error);
                showErrorMessage('Unable to open email client. Please contact us directly at support@toursync.app');
            } finally {
                // Reset button state
                sendBtn.classList.remove('loading');
                sendBtn.textContent = originalText;
                sendBtn.disabled = false;
            }
        }

        // Close popup when clicking outside
        document.addEventListener('click', function(event) {
            const popup = document.getElementById('email-popup');
            if (event.target === popup) {
                closeEmailPopup();
            }
        });

        // Close popup with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeEmailPopup();
            }
        });

        // Handle contact button clicks
        document.addEventListener('DOMContentLoaded', function() {
            // Email icon in footer
            const emailBtn = document.getElementById('email-contact-btn');
            if (emailBtn) {
                emailBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openEmailPopup();
                });
            }
            
            // Contact Us link in navigation
            const contactNavLinks = document.querySelectorAll('a[href="#footer"]');
            contactNavLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Scroll to footer
                    const footer = document.getElementById('footer');
                    if (footer) {
                        footer.scrollIntoView({ 
                            behavior: 'smooth',
                            block: 'start'
                        });
                        
                        // Open email popup after scroll
                        setTimeout(() => {
                            openEmailPopup();
                        }, 500);
                    }
                });
            });
        });
    </script>

</body>
</html>